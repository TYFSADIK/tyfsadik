<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Hosted DNS Server (Pi-hole + Unbound) - TYF Sadik</title>
    <link rel="icon" type="image/png" href="../favicon.png" sizes="32x32">
    <meta name="title" content="Self-Hosted DNS Server (Pi-hole + Unbound) - TYF Sadik">
    <meta name="description" content="Robust, privacy-focused DNS infrastructure combining Pi-hole for ad-blocking and Unbound for recursive DNS resolution">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.tyfsadik.com/work/dns-server/">
    <meta property="og:title" content="Self-Hosted DNS Server (Pi-hole + Unbound) - TYF Sadik">
    <meta property="og:description" content="Robust, privacy-focused DNS infrastructure combining Pi-hole for ad-blocking and Unbound for recursive DNS resolution">
    <meta property="og:image" content="https://tyfsadik.com/assets/dns-server.jpg">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.tyfsadik.com/work/dns-server/">
    <meta property="twitter:title" content="Self-Hosted DNS Server (Pi-hole + Unbound)">
    <meta property="twitter:description" content="Robust, privacy-focused DNS infrastructure combining Pi-hole for ad-blocking and Unbound for recursive DNS resolution">
    <meta property="twitter:image" content="https://tyfsadik.com/assets/dns-server.jpg">
    <link rel="icon" type="image/jpeg" href="https://www.tyfsadik.com/assets/me.jpg">
    <link rel="stylesheet" href="../_astro/about.CzspFIqT.css" />
    <style>
        @import"https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap";
        @font-face{font-family:Departure Neon;src:url(../fonts/DepartureMono-Regular.woff) format("woff");font-weight:400;font-style:normal;font-display:swap}
        body{--tw-bg-opacity: 1;background-color:rgb(238 238 238 / var(--tw-bg-opacity));font-family:Departure Neon,IBM Plex\ Mono,Source\ Code\ Pro,Consolas,Menlo,monospace;--tw-text-opacity: 1;color:rgb(34 34 34 / var(--tw-text-opacity));font-display:swap}
        ::-webkit-scrollbar-track{-webkit-box-shadow:inset 0 0 4px rgba(0,0,0,.6);border-radius:10px;background-color:#0000004d}
        ::-webkit-scrollbar{width:4px;--tw-bg-opacity: 1;background-color:rgb(107 114 128 / var(--tw-bg-opacity))}
        ::-webkit-scrollbar-thumb{border-radius:10px;-webkit-box-shadow:inset 0 0 4px rgba(0,0,0,.3);--tw-bg-opacity: 1;background-color:rgb(209 213 219 / var(--tw-bg-opacity))}
        ::-moz-selection{--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity))}
        ::selection{--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity))}
        .typography{font-family:Inter;font-display:swap}
        .typography h1{margin-top:1.5rem;margin-bottom:.5rem;font-size:1.25rem;line-height:1.75rem;font-weight:700}
        .typography h2{margin-top:1.25rem;margin-bottom:.5rem;font-size:1.1rem;line-height:1.5rem;font-weight:600}
        .typography p{margin-bottom:.75rem;--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}
        .typography a{text-decoration-line:underline}
        .typography a:hover{--tw-bg-opacity: 1;background-color:rgb(250 204 21 / var(--tw-bg-opacity))}
        .typography img{margin-top:1rem;margin-bottom:1rem;height:auto;width:100%}
        .typography pre{margin-top:1rem;margin-bottom:1rem;padding:.5rem;background-color:#f5f5f5;border:1px solid #ddd;border-radius:4px;overflow-x:auto;--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}
        .typography ul{margin-top:1rem;margin-bottom:1rem;list-style-type:disc;padding-left:2rem}
        .typography ol{margin-top:1rem;margin-bottom:1rem;list-style-type:decimal;padding-left:3rem}
        .typography li{margin-top:.5rem;margin-bottom:.5rem}
        .typography li::marker{font-family:Departure Neon,IBM Plex\ Mono,Source\ Code\ Pro,Consolas,Menlo,monospace;--tw-text-opacity: 1;color:rgb(102 102 102 / var(--tw-text-opacity))}
        .typography blockquote{margin-top:1rem;margin-bottom:1rem;--tw-bg-opacity: 1;background-color:rgb(204 204 204 / var(--tw-bg-opacity));padding:.5rem;--tw-text-opacity: 1;color:rgb(0 0 0 / var(--tw-text-opacity))}
        .typography table{margin-top:1rem;margin-bottom:1rem;width:100%;border-collapse:collapse}
        .typography table th{border:1px solid #222;padding:.5rem;background-color:#f0f0f0;font-weight:600}
        .typography table td{border:1px solid #222;padding:.5rem}
        .typography table th:last-child,.typography table td:last-child{border-right-width:1px}
        .typography table tr:nth-child(even){background-color:#f9f9f9}
        .architecture-img{max-width:100%;height:auto;border:1px solid #ddd;border-radius:4px}
    </style>
</head>
<body class="max-w-screen-md mx-auto px-4 lg:px-0">
    <nav class="flex flex-col justify-between pb-2 pt-2 lg:pt-8">
        <div class="uppercase flex items-center justify-between py-2">
            <span id="title" class="font-black text-2xl md:text-6xl">‚ñà‚ñì‚ñí‚ñë TYF Sadik</span>
            <a href="../about.html" class="text-carbon ml-auto px-2 absolute -right-5 top-6 md:relative md:top-auto md:right-none pt-[2px] pb-0 text-xs md:text-sm -rotate-90 bg-enamel text-carbon hover:text-enamel hover:bg-carbon transition-colors">‚å• PROD</a>
        </div>
        <div class="flex gap-x-2 pt-8">
            <a class="capitalize px-2 pb-0 pt-[1px] flex items-center justify-center gap-x-2 text-sm md:text-md hover:bg-yellow-400 transition-colors " href="../index.html"> ‚ú¶ PROFILE </a>
            <a class="capitalize px-2 pb-0 pt-[1px] flex items-center justify-center gap-x-2 text-sm md:text-md hover:bg-yellow-400 transition-colors " href="../blog.html"> ¬∂ BLOG </a>
            <a class="capitalize px-2 pb-0 pt-[1px] flex items-center justify-center gap-x-2 text-sm md:text-md hover:bg-yellow-400 transition-colors bg-yellow-400 text-black" href="../work.html"> ‚â• WORK </a>
        </div>
    </nav>
    
    <main>
        <article class="pt-10 typography font-sans">
            <div class="flex justify-between items-center">
                <a href="../work.html" class="text-carbon-lighter font-mono hover:bg-yellow-400 hover:text-black transition-colors">‚Üê Back</a>
                <dl>
                    <dt class="sr-only">Date</dt>
                    <dd class="whitespace-nowrap not-prose pl-0 leading-6 font-mono text-sm text-carbon-lighter uppercase">
                        <time datetime="2024-03-20">20 March 2024</time>
                    </dd>
                </dl>
            </div>
            
            <h1 class="font-mono uppercase text-2xl text-carbon-lighter">üåê Self-Hosted DNS Server (Pi-hole + Unbound)</h1>
            
            <figure>
                <img src="../_astro/dns-server-architecture.jpg" alt="DNS Server Architecture" class="architecture-img">
            </figure>
            
            <section>
                <p>A robust, privacy-focused DNS infrastructure combining <strong>Pi-hole</strong> for ad-blocking and <strong>Unbound</strong> for recursive DNS resolution. This setup provides complete DNS independence, enhanced privacy, and network-wide ad blocking.</p>
            </section>
            
            <section>
                <h1 id="overview">üöÄ Overview</h1>
                <p>This project implements a self-hosted DNS resolution stack that eliminates dependence on external DNS providers. By combining <strong>Pi-hole</strong> (network-wide ad/tracker blocking) with <strong>Unbound</strong> (recursive DNS resolver), the system provides:</p>
                <ul>
                    <li><strong>Complete Privacy</strong>: No DNS query logging by third parties</li>
                    <li><strong>Enhanced Performance</strong>: Local caching for faster resolution</li>
                    <li><strong>Ad-Free Browsing</strong>: Network-wide blocking of ads and trackers</li>
                    <li><strong>Security</strong>: DNSSEC validation and encrypted upstream communication</li>
                </ul>
            </section>
            
            <section>
                <h1 id="features">‚ö° Features</h1>
                
                <h2 id="privacy-security">üîí Privacy & Security</h2>
                <ul>
                    <li><strong>Recursive DNS Resolution</strong>: Queries start from root servers</li>
                    <li><strong>DNSSEC Validation</strong>: Ensures DNS response authenticity</li>
                    <li><strong>No Logging</strong>: Self-hosted means no third-party data collection</li>
                </ul>
                
                <h2 id="performance">üöÄ Performance</h2>
                <ul>
                    <li><strong>Local Caching</strong>: Redundant query resolution in milliseconds</li>
                    <li><strong>Aggressive Caching</strong>: TTL optimization for frequent domains</li>
                </ul>
            </section>
            
            <section>
                <h1 id="detailed-setup-guide">üìñ Detailed Setup Guide</h1>
                
                <h2 id="lxc-container-setup">Step 1: LXC Container Setup</h2>
                <pre><code># Create new LXC container (adjust ID and storage as needed)
pct create 100 debian-12-standard_12.2-1_amd64.tar.zst \
  --storage local-lvm \
  --net0 name=eth0,bridge=vmbr0,ip=dhcp \
  --memory 512 \
  --cores 1

# Start container and set static IP
pct start 100
pct set 100 --net0 name=eth0,bridge=vmbr0,ip=192.168.1.10/24,gw=192.168.1.1</code></pre>
                
                <h2 id="pi-hole-installation">Step 2: Pi-hole Installation</h2>
                <pre><code># Update system and install Pi-hole
apt update && apt upgrade -y
curl -sSL https://install.pi-hole.net | bash</code></pre>
                
                <h2 id="unbound-installation-configuration">Step 3: Unbound Installation & Configuration</h2>
                <pre><code># Install Unbound
apt install unbound unbound-anchor -y

# Download root hints
curl -o /var/lib/unbound/root.hints https://www.internic.net/domain/named.cache

# Create unbound configuration
cat > /etc/unbound/unbound.conf.d/pi-hole.conf << 'EOF'
server:
    verbosity: 1
    interface: 127.0.0.1
    port: 5335
    do-ip4: yes
    do-udp: yes
    do-tcp: yes
    prefer-ip6: no
    harden-glue: yes
    harden-dnssec-stripped: yes
    use-caps-for-id: yes
    edns-buffer-size: 1472
    prefetch: yes
    num-threads: 1
    so-rcvbuf: 1m
    private-address: 192.168.0.0/16
    private-address: 169.254.0.0/16
    private-address: 172.16.0.0/12
    private-address: 10.0.0.0/8
    private-address: fd00::/8
    private-address: fe80::/10

    # Root hints
    root-hints: "/var/lib/unbound/root.hints"

    # DNSSEC
    auto-trust-anchor-file: "/var/lib/unbound/root.key"
    val-log-level: 2

    # Cache settings
    key-cache-size: 64m
    key-cache-slabs: 4
    neg-cache-size: 32m
    msg-cache-size: 32m
    msg-cache-slabs: 4
    rrset-cache-size: 64m
    rrset-cache-slabs: 4
    cache-min-ttl: 3600
    cache-max-ttl: 86400

    # Security
    unwanted-reply-threshold: 10000000
    val-nsec-type: "proof"
    serve-expired: yes
    serve-expired-ttl: 3600
    aggressive-nsec: yes
EOF

# Initialize root anchor and set permissions
unbound-anchor -a /var/lib/unbound/root.key
chown unbound:unbound /var/lib/unbound/root.hints
chown unbound:unbound /var/lib/unbound/root.key

# Start and enable Unbound
systemctl enable unbound
systemctl start unbound

# Test Unbound
dig @127.0.0.1 -p 5335 google.com</code></pre>
                
                <h2 id="configure-pi-hole-to-use-unbound">Step 4: Configure Pi-hole to Use Unbound</h2>
                <ol>
                    <li>Access Pi-hole admin panel: <code>http://your-container-ip/admin</code></li>
                    <li>Navigate to <strong>Settings > DNS</strong></li>
                    <li>Remove all upstream DNS servers</li>
                    <li>Add custom upstream DNS: <code>127.0.0.1#5335</code></li>
                    <li>Enable <strong>Use DNSSEC</strong> and <strong>Use conditional forwarding</strong> if needed</li>
                </ol>
                
                <h2 id="router-configuration">Step 5: Router Configuration</h2>
                <p>Configure your router to use the Pi-hole container as the primary DNS server:</p>
                <ul>
                    <li><strong>DHCP DNS Settings</strong>: Set to your container's IP (e.g., 192.168.1.10)</li>
                </ul>
            </section>
            
            <section>
                <h1 id="troubleshooting">üêõ Troubleshooting</h1>
                
                <h2 id="common-issues-solutions">Common Issues & Solutions</h2>
                
                <h3 id="dns-resolution-failing">DNS Resolution Failing</h3>
                <pre><code># Test Unbound resolution
dig @127.0.0.1 -p 5335 example.com

# Check Unbound logs
journalctl -u unbound -f</code></pre>
                
                <h3 id="service-not-starting">Service Not Starting</h3>
                <pre><code># Check service status
systemctl status unbound
systemctl status pihole-FTL

# Verify configuration syntax
unbound-checkconf /etc/unbound/unbound.conf.d/pi-hole.conf</code></pre>
            </section>
            
            <section>
                <h1 id="monitoring-maintenance">üìä Monitoring & Maintenance</h1>
                <pre><code># Check service status
systemctl status pihole-FTL
systemctl status unbound

# Update blocklists
pihole -g

# Update Unbound root hints
curl -o /var/lib/unbound/root.hints https://www.internic.net/domain/named.cache
systemctl restart unbound</code></pre>
            </section>
            
            <section>
                <h1 id="license">üìÑ License</h1>
                <p>This project is licensed under the MIT License.</p>
            </section>
            
            <section>
                <h1 id="connect">üåê Connect</h1>
                <p><strong>Taki Sadik</strong></p>
                <ul>
                    <li>üñ•Ô∏è <strong>GitHub</strong>: <a href="https://github.com/TYFSADIK">TYFSADIK</a></li>
                    <li>üåç <strong>Website</strong>: <a href="https://tyfsadik.com">tyfsadik.org</a></li>
                </ul>
            </section>
            
            <section>
                <p><em>Last updated: March 2024</em><br>
                <em>Maintained with ‚ù§Ô∏è by Taki Sadik</em></p>
            </section>
            
            <section>
                <p><strong>‚≠ê If this project helped you, please consider giving it a star on GitHub!</strong></p>
            </section>
            
            <section class="giscus mx-auto my-10 max-w-screen-md">
                <script src="https://giscus.app/client.js" data-repo="TYFSADIK/tyfsadik" data-repo-id="R_kgDOOk6Jdw" data-category="Announcements" data-category-id="DIC_kwDOOk6Jd84Cpz1k" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="en" crossorigin="anonymous" async></script>
            </section>
            
            <div>
                <div class="pt-8 pb-4 text-sm" id="contact">
                    <div class="grid grid-cols-3 text-center lg:grid-cols-6 gap-y-2">
                        <a target="_blank" class="underline hover:bg-amber/40 px-2" href="mailto:hambahumbu@gmail.com?subject=Hello">Email</a>
                        <a target="_blank" class="underline hover:bg-amber/40 px-2" href="https://www.linkedin.com/in/md-taki-yasir-faraji-sadik-63a026278/">LinkedIn</a>
                        <a target="_blank" class="underline hover:bg-amber/40 px-2" href="https://github.com/TYFSADIK">GitHub</a>
                        <a target="_blank" class="underline hover:bg-amber/40 px-2" href="https://x.com/chill_____guy">&#120143;</a>
                        <a target="_blank" class="underline hover:bg-amber/40 px-2" href="https://www.youtube.com/@TYF_SADIK">YouTube</a>
                        <a target="_blank" class="underline hover:bg-amber/40 px-2" href="https://www.instagram.com/sadik__actually/">Instagram</a>
                    </div>
                </div>
                
                <footer class="pt-8 pb-8 px-2 lg:px-0 text-center border-carbon text-xs text-carbon">
                    &copy; 2018 - 2025, TYF Sadik.<wbr> Creative Commons Attribution 4.0 International License.
                </footer>
            </div>
        </article>
    </main>
</body>
</html>
